
# 思路2

## 1. 背景

在正交投影下：

* 相机的视线方向是单位向量 $\mathbf{z}$。
* 从像素点换算出来的平面点是 $\mathbf{P}$。
* 我们要求的 3D 点 $\mathbf{X}$，必须满足：

$$
(\mathbf{X} - \mathbf{P}) \perp \mathbf{z}
$$

也就是 $\mathbf{X} - \mathbf{P}$ 与 $\mathbf{z}$ 正交。
换句话说，$\mathbf{X}$ 投影到 $\mathbf{z}$ 的方向应该等于 $\mathbf{P}$ 投影到 $\mathbf{z}$ 的方向。

---

## 2. 投影矩阵的意义

数学上：
* `np.outer(z, z)` 表示向量 $z$ 自身的外积（outer product），结果是一个矩阵。具体地，如果 $z$ 是一个三维向量：
$$
np.outer(z, z) = z z^T = 
\begin{bmatrix}
z_1 z_1 & z_1 z_2 & z_1 z_3 \\
z_2 z_1 & z_2 z_2 & z_2 z_3 \\
z_3 z_1 & z_3 z_2 & z_3 z_3
\end{bmatrix}
$$

由于 $z$ 是单位向量（即 $\|z\| = 1$），这个矩阵有一些特殊的性质：

- **对称矩阵**：显然，$(z z^T)^T = z z^T$。
- **秩为1的矩阵**：因为所有列都是向量 $z$ 的倍数。
- **投影矩阵**：这个矩阵表示的是向量 $z$ 所在方向的投影矩阵。换句话说，对于任意向量 $x$，有：

$$
(z z^T) x = z (z^T x) = (z \cdot x) z
$$

也就是说，它将任意向量 $x$ 投影到向量 $z$ 所在的直线上（其结果仍然是一个向量）。

接下来看 `I - np.outer(z, z)`，其中 $I$ 是单位矩阵：

$$
I - z z^T = 
\begin{bmatrix}
1 - z_1 z_1 & - z_1 z_2 & - z_1 z_3 \\
- z_2 z_1 & 1 - z_2 z_2 & - z_2 z_3 \\
- z_3 z_1 & - z_3 z_2 & 1 - z_3 z_3
\end{bmatrix}
$$

这个矩阵也有明确的含义：

- **对称矩阵**：显然，$(I - z z^T)^T = I - z z^T$。
- **投影矩阵**：它表示的是**垂直于向量 $z$** 的子空间的投影矩阵。换句话说，对于任意向量 $x$，有：

$$
(I - z z^T) x = x - (z z^T) x = x - (z \cdot x) z
$$

这正是将向量 $x$ 投影到与 $z$ 垂直的平面（或子空间）上的操作。


* 因此：
  $$
  (I - \mathbf{z} \mathbf{z}^T)\mathbf{v}
  $$
  就是把 $\mathbf{v}$ 投影到与 $\mathbf{z}$ 正交的平面上。

所以：

```python
I = np.eye(3)
M = I - np.outer(z, z)
```

这里的 `M` 就是 **投影到平面（垂直于 z 的方向）** 的矩阵。

---

## 3. 代入我们的约束

我们要求：
$$
(\mathbf{X} - \mathbf{P}) \cdot \mathbf{z} = 0
$$

等价于：
$$
(I - \mathbf{z}\mathbf{z}^T)\mathbf{X} = (I - \mathbf{z}\mathbf{z}^T)\mathbf{P}
$$

也就是说，我们把 (\mathbf{X}) 和 (\mathbf{P}) 都投影到与 (\mathbf{z}) 垂直的平面上，它们必须重合。

这就是代码里：

```python
A += M
b += M @ P
```

---

## 4. 直观理解

想象一下：

* 相机视线是 (\mathbf{z})，
* 任何点沿着 (\mathbf{z}) 的方向都投影到同一个像素点。

所以我们只需要关心点在 **垂直于 (\mathbf{z}) 的平面上** 的位置（就是 M 的作用）。

* `M @ X` = 把候选点 X 投影到“相机看到的平面”；
* `M @ P` = 像素点对应的平面位置；
* 方程 `(I - zz^T)X = (I - zz^T)P` 表示：候选 3D 点和像素平面点在相机投影下必须一致。

---

## 5. 总结

这两行代码：

```python
I = np.eye(3)
M = I - np.outer(z, z)
```

表示构造一个 **投影矩阵 M**，
它的作用是：

* **去掉向量在相机视线方向上的分量**，
* 把向量投影到与相机视线垂直的平面上。

这样我们就能把“像素点在世界平面上的约束”写成线性方程来解。

---

要不要我帮你画一张图，把 (\mathbf{z})、(\mathbf{P})、(\mathbf{X})、以及投影矩阵 (M) 的几何关系画出来？这样一眼就能看出为什么要用 (I - zz^T)。
